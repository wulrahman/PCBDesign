<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom PCB Layout</title>
    <style>
        #container {
            display: flex;
            align-items: flex-start;
        }

        #editor {
            width: 300px;
            height: 600px;
            border: 1px solid black;
            margin: 20px;
            padding: 10px;
            font-family: monospace;
        }

        #pcb-container {
            width: 600px;
            height: 600px;
            border: 1px solid black;
            margin: 20px;
            position: relative;
        }
    </style>
</head>
<body>
    <div id="container">
        <textarea id="editor" placeholder="Enter commands here">  // Example PCB Layout
            // Define components and their positions
        
            add(type="roundpad", x="105", y="155", outerRadius="15", innerRadius="5") // Round pad
            add(type="outline", x="90", y="140", width="30", height="30") // Outline for round pad
            add(type="label", x="95", y="130", text="Round Pad") // Label for round pad
        
            add(type="squarepad", x="250", y="150", width="20", height="20") // Square pad
            add(type="outline", x="235", y="135", width="40", height="40") // Outline for square pad
            add(type="label", x="240", y="120", text="Square Pad") // Label for square pad
        
            add(type="squarepad", x="400", y="300", width="20", height="20") // Another square pad
            add(type="outline", x="385", y="285", width="40", height="40") // Outline for another square pad
            add(type="label", x="390", y="270", text="Another Pad") // Label for another square pad
        
            add(type="squarepad", x="200", y="400", width="20", height="20") // Square pad
            add(type="outline", x="185", y="385", width="40", height="40") // Outline for square pad
            add(type="label", x="190", y="370", text="Square Pad") // Label for square pad
        
            add(type="squarepad", x="500", y="400", width="20", height="20") // Square pad
            add(type="outline", x="485", y="385", width="40", height="40") // Outline for square pad
            add(type="label", x="490", y="370", text="Square Pad") // Label for square pad
        
            // Add connections between components if needed
            connect(component1=0, component2=4) // Connect first two components
            connect(component1=4, component2=10) // Connect third and fourth components</textarea>
        <div id="pcb-container"></div>
        <button id="auto-route-btn">Auto Route</button> <!-- Button to trigger auto-routing -->

    </div>

    <script src="PCBLayout.js"></script>
    <script>
         // Define auto-route function
         function autoRoute() {
            // Perform auto-routing
            pcbLayout.autoRoute();
        }

        // Auto-route button click event listener
        document.getElementById("auto-route-btn").addEventListener("click", autoRoute);

        const pcbLayout = new PCBLayout({
            container: "pcb-container",
            width: 600,
            height: 600
        });

        function parseCommands(commands) {
            // Split commands by newline
            const lines = commands.split('\n');

            // Process each command
            lines.forEach(line => {
                // Ignore lines that start with '//'
                if (line.trim().startsWith('//')) return;

                const command = line.split('//')[0].trim(); // Remove everything after '//' (if any) and trim whitespace

                const match = command.match(/^(\w+)\((.*)\)$/);
                if (match) {
                    const commandName = match[1];
                    const attributeStr = match[2];

                    // Extract attribute key-value pairs
                    const attributes = {};
                    const attributePairs = attributeStr.split(/,(?![^()]*\))/); // Split by comma, but ignore commas inside parentheses
                    attributePairs.forEach(pair => {
                        const [key, value] = pair.split('=');
                        attributes[key.trim()] = value.replace(/^["'](.*)["']$/, '$1').trim(); // Remove surrounding quotes
                    });

                    // Process commands
                    switch (commandName) {
                        case 'add':
                            // Handle add command
                            if (attributes.type && attributes.x && attributes.y && attributes.size) {
                                addComponent(attributes.type, parseInt(attributes.x), parseInt(attributes.y), { size: parseInt(attributes.size) });
                            } else if (attributes.type && attributes.x && attributes.y && attributes.text) {
                                addComponent(attributes.type, parseInt(attributes.x), parseInt(attributes.y), { text: attributes.text });
                            } else if (attributes.type && attributes.x && attributes.y && attributes.width && attributes.height) {
                                addComponent(attributes.type, parseInt(attributes.x), parseInt(attributes.y), { width: parseInt(attributes.width), height: parseInt(attributes.height) });
                            } else if (attributes.type && attributes.x && attributes.y && attributes.outerRadius) {
                                // Add round pad
                                addComponent(attributes.type, parseInt(attributes.x), parseInt(attributes.y), { outerRadius: parseInt(attributes.outerRadius), innerRadius: parseInt(attributes.innerRadius) });
                            } else if (attributes.type && attributes.x && attributes.y && attributes.width && attributes.height) {
                                // Add square pad
                                addComponent(attributes.type, parseInt(attributes.x), parseInt(attributes.y), { width: parseInt(attributes.width), height: parseInt(attributes.height) });
                            } else {
                                console.error('Invalid number of arguments for "add" command.');
                            }
                            break;
                        case 'connect':
                            // Handle connect command
                            if (attributes.component1 && attributes.component2) {
                                connectComponents(parseInt(attributes.component1), parseInt(attributes.component2));
                            } else {
                                console.error('Invalid arguments for "connect" command.');
                            }
                            break;
                        // Add more commands as needed
                        default:
                            console.error(`Unknown command: ${commandName}`);
                            break;
                    }
                } else {
                    console.error('Invalid command format.');
                }
            });
        }

    const editor = document.getElementById("editor");
        editor.addEventListener("input", () => {
            const commands = editor.value;
            pcbLayout.clear(); // Clear existing layout
            parseCommands(commands); // Parse and execute commands
        });
    // Parse and execute commands
    parseCommands( editor.value);

    function connectComponents(componentId1, componentId2) {

        // Find components by their IDs
        const component1 = pcbLayout.components[componentId1]; // Adjust index for array
        const component2 = pcbLayout.components[componentId2]; // Adjust index for array

        if (component1 && component2) {
            pcbLayout.autoConnect(component1, component2)
        } else {
            console.error('One or both components not found.');
        }
    }


    function parseAttributes(attributeStr) {
        const attributes = {};
        // Extract attribute key-value pairs
        const attributePairs = attributeStr.split(',').map(pair => pair.trim());
        // Process each pair
        attributePairs.forEach(pair => {
            const [key, value] = pair.split('=');
            attributes[key.trim().toLowerCase()] = value.trim();
        });
        return attributes;
    }

    function addComponent(type, x, y, attributes) {
        // Add component logic based on type and attributes

        var width, height;
        switch (type) {
            case 'pad':
                // Example: Add a pad component
                const size = parseInt(attributes.size);
                pcbLayout.createPad({ x, y, size });
                break;
            case 'outline':
                // Example: Add an outline component
                width = parseInt(attributes.width);
                height = parseInt(attributes.height);
                pcbLayout.createOutline({ x, y, width, height });
                break;
            case 'label':
                // Example: Add a label component
                const text = attributes.text;
                pcbLayout.createLabel({ x, y, text });
                break;
            case 'roundpad':
                // Example: Add a round pad component
                const innerRadius = parseInt(attributes.innerRadius);
                const outerRadius = parseInt(attributes.outerRadius);
                pcbLayout.createRoundPad({ x, y, innerRadius, outerRadius });
                break;
            case 'squarepad':
                // Example: Add a square pad component
                width = parseInt(attributes.width);
                height = parseInt(attributes.height);
                pcbLayout.createSquarePad({ x, y, width, height });
                break;
            default:
                console.error(`Unknown component type: ${type}`);
                break;
        }
    }


    </script>
</body>
</html>
